import torch 
import torch.nn as nn
import torch.optim as optim
import torch.utils.data as data
import numpy as np
import json
import matplotlib.pyplot as plt

from train import load_data, create_dataset, BeehiveModel

test_data_weight = [{"datum":"05/04/24","stan":"1221601","timestamp":1712275200000,"weight":30.2,"rozdil":0.2,"temperature":4.7}, {"datum":"05/04/24","stan":"1221601","timestamp":1712296800000,"weight":30.2,"rozdil":0,"temperature":2.7}, {"datum":"05/04/24","stan":"1221601","timestamp":1712318400000,"weight":30.2,"rozdil":0,"temperature":14.7}, {"datum":"05/04/24","stan":"1221601","timestamp":1712340000000,"weight":34,"rozdil":3.8,"temperature":18}, {"datum":"06/04/24","stan":"1221601","timestamp":1712361600000,"weight":33.8,"rozdil":-0.2,"temperature":14.4}, {"datum":"06/04/24","stan":"1221601","timestamp":1712383200000,"weight":33.6,"rozdil":-0.2,"temperature":10.9}, {"datum":"06/04/24","stan":"1221601","timestamp":1712404800000,"weight":33.6,"rozdil":0,"temperature":22.2}, {"datum":"06/04/24","stan":"1221601","timestamp":1712426400000,"weight":35.1,"rozdil":1.5,"temperature":24}, {"datum":"07/04/24","stan":"1221601","timestamp":1712448000000,"weight":35,"rozdil":-0.1,"temperature":7.6}, {"datum":"07/04/24","stan":"1221601","timestamp":1712469600000,"weight":34.8,"rozdil":-0.2,"temperature":4}, {"datum":"07/04/24","stan":"1221601","timestamp":1712491200000,"weight":35,"rozdil":0.2,"temperature":23.6}, {"datum":"07/04/24","stan":"1221601","timestamp":1712512800000,"weight":36.2,"rozdil":1.2,"temperature":23.6}, {"datum":"07/04/24","stan":"1221601","timestamp":1712523600000,"weight":36.3,"rozdil":0.1,"temperature":13.6}, {"datum":"08/04/24","stan":"1221601","timestamp":1712534400000,"weight":36.2,"rozdil":-0.1,"temperature":9.6}, {"datum":"08/04/24","stan":"1221601","timestamp":1712545200000,"weight":36.2,"rozdil":0,"temperature":8}, {"datum":"08/04/24","stan":"1221601","timestamp":1712556000000,"weight":36,"rozdil":-0.2,"temperature":8.4}, {"datum":"08/04/24","stan":"1221601","timestamp":1712566800000,"weight":35.8,"rozdil":-0.2,"temperature":14.2}, {"datum":"08/04/24","stan":"1221601","timestamp":1712577600000,"weight":36.4,"rozdil":0.6,"temperature":24}, {"datum":"08/04/24","stan":"1221601","timestamp":1712588400000,"weight":37.4,"rozdil":1,"temperature":26.9}, {"datum":"08/04/24","stan":"1221601","timestamp":1712599200000,"weight":38.2,"rozdil":0.8,"temperature":26.2}, {"datum":"08/04/24","stan":"1221601","timestamp":1712610000000,"weight":38.4,"rozdil":0.2,"temperature":15.2}, {"datum":"09/04/24","stan":"1221601","timestamp":1712620800000,"weight":38.2,"rozdil":-0.2,"temperature":11.4}, {"datum":"09/04/24","stan":"1221601","timestamp":1712631600000,"weight":38.1,"rozdil":-0.1,"temperature":8.9}, {"datum":"09/04/24","stan":"1221601","timestamp":1712642400000,"weight":38.1,"rozdil":0,"temperature":7.6}, {"datum":"09/04/24","stan":"1221601","timestamp":1712653200000,"weight":37.8,"rozdil":-0.3,"temperature":15.2}, {"datum":"09/04/24","stan":"1221601","timestamp":1712664000000,"weight":38.2,"rozdil":0.4,"temperature":24}, {"datum":"09/04/24","stan":"1221601","timestamp":1712674800000,"weight":39.1,"rozdil":0.9,"temperature":25.6}, {"datum":"09/04/24","stan":"1221601","timestamp":1712685600000,"weight":39.9,"rozdil":0.8,"temperature":19.4}, {"datum":"09/04/24","stan":"1221601","timestamp":1712696400000,"weight":39.6,"rozdil":-0.3,"temperature":12.7}, {"datum":"10/04/24","stan":"1221601","timestamp":1712707200000,"weight":40,"rozdil":0.4,"temperature":7.4}, {"datum":"10/04/24","stan":"1221601","timestamp":1712718000000,"weight":40,"rozdil":0,"temperature":6.7}, {"datum":"10/04/24","stan":"1221601","timestamp":1712728800000,"weight":40,"rozdil":0,"temperature":6.4}, {"datum":"10/04/24","stan":"1221601","timestamp":1712739600000,"weight":40,"rozdil":0,"temperature":7.6}, {"datum":"10/04/24","stan":"1221601","timestamp":1712750400000,"weight":40,"rozdil":0,"temperature":10.7}, {"datum":"10/04/24","stan":"1221601","timestamp":1712761200000,"weight":39.8,"rozdil":-0.2,"temperature":13.2}, {"datum":"10/04/24","stan":"1221601","timestamp":1712772000000,"weight":39.6,"rozdil":-0.2,"temperature":11.6}, {"datum":"10/04/24","stan":"1221601","timestamp":1712782800000,"weight":39.4,"rozdil":-0.2,"temperature":6.4}, {"datum":"11/04/24","stan":"1221601","timestamp":1712793600000,"weight":39.4,"rozdil":0,"temperature":2.7}, {"datum":"11/04/24","stan":"1221601","timestamp":1712804400000,"weight":39.4,"rozdil":0,"temperature":0.9}, {"datum":"11/04/24","stan":"1221601","timestamp":1712815200000,"weight":39.2,"rozdil":-0.2,"temperature":-0.2}, {"datum":"11/04/24","stan":"1221601","timestamp":1712826000000,"weight":39.2,"rozdil":0,"temperature":7.4}, {"datum":"11/04/24","stan":"1221601","timestamp":1712836800000,"weight":38.9,"rozdil":-0.3,"temperature":15.2}, {"datum":"11/04/24","stan":"1221601","timestamp":1712847600000,"weight":39.6,"rozdil":0.7,"temperature":18.7}, {"datum":"11/04/24","stan":"1221601","timestamp":1712858400000,"weight":40.2,"rozdil":0.6,"temperature":16.4}, {"datum":"11/04/24","stan":"1221601","timestamp":1712869200000,"weight":40,"rozdil":-0.2,"temperature":7.6}, {"datum":"12/04/24","stan":"1221601","timestamp":1712880000000,"weight":39.9,"rozdil":-0.1,"temperature":4.2}, {"datum":"12/04/24","stan":"1221601","timestamp":1712890800000,"weight":39.8,"rozdil":-0.1,"temperature":2.9}, {"datum":"12/04/24","stan":"1221601","timestamp":1712901600000,"weight":39.8,"rozdil":0,"temperature":1.4}, {"datum":"12/04/24","stan":"1221601","timestamp":1712912400000,"weight":39.8,"rozdil":0,"temperature":10.7}, {"datum":"12/04/24","stan":"1221601","timestamp":1712923200000,"weight":39.6,"rozdil":-0.2,"temperature":19.2}, {"datum":"12/04/24","stan":"1221601","timestamp":1712934000000,"weight":40.6,"rozdil":1,"temperature":21.4}, {"datum":"12/04/24","stan":"1221601","timestamp":1712944800000,"weight":41.4,"rozdil":0.8,"temperature":20.2}, {"datum":"12/04/24","stan":"1221601","timestamp":1712955600000,"weight":41.2,"rozdil":-0.2,"temperature":10.2}, {"datum":"13/04/24","stan":"1221601","timestamp":1712966400000,"weight":41.1,"rozdil":-0.1,"temperature":6.2}, {"datum":"13/04/24","stan":"1221601","timestamp":1712977200000,"weight":41,"rozdil":-0.1,"temperature":4.4}, {"datum":"13/04/24","stan":"1221601","timestamp":1712988000000,"weight":40.8,"rozdil":-0.2,"temperature":2.9}, {"datum":"13/04/24","stan":"1221601","timestamp":1712998800000,"weight":40.8,"rozdil":0,"temperature":12.9}, {"datum":"13/04/24","stan":"1221601","timestamp":1713009600000,"weight":41,"rozdil":0.2,"temperature":20.9}, {"datum":"13/04/24","stan":"1221601","timestamp":1713020400000,"weight":42,"rozdil":1,"temperature":23.4}, {"datum":"13/04/24","stan":"1221601","timestamp":1713031200000,"weight":49.2,"rozdil":7.2,"temperature":22}, {"datum":"13/04/24","stan":"1221601","timestamp":1713042000000,"weight":49.1,"rozdil":-0.1,"temperature":13.6}, {"datum":"14/04/24","stan":"1221601","timestamp":1713052800000,"weight":49,"rozdil":-0.1,"temperature":8.2}, {"datum":"14/04/24","stan":"1221601","timestamp":1713063600000,"weight":48.8,"rozdil":-0.2,"temperature":6.9}, {"datum":"14/04/24","stan":"1221601","timestamp":1713074400000,"weight":48.7,"rozdil":-0.1,"temperature":6.4}, {"datum":"14/04/24","stan":"1221601","timestamp":1713085200000,"weight":48.6,"rozdil":-0.1,"temperature":16.2}, {"datum":"14/04/24","stan":"1221601","timestamp":1713096000000,"weight":48.7,"rozdil":0.1,"temperature":21.6}, {"datum":"14/04/24","stan":"1221601","timestamp":1713106800000,"weight":49.4,"rozdil":0.7,"temperature":23.4}, {"datum":"14/04/24","stan":"1221601","timestamp":1713117600000,"weight":49.8,"rozdil":0.4,"temperature":20.7}, {"datum":"14/04/24","stan":"1221601","timestamp":1713128400000,"weight":49.8,"rozdil":0,"temperature":13.2}, {"datum":"15/04/24","stan":"1221601","timestamp":1713139200000,"weight":49.8,"rozdil":0,"temperature":10.2}, {"datum":"15/04/24","stan":"1221601","timestamp":1713150000000,"weight":49.6,"rozdil":-0.2,"temperature":8.9}, {"datum":"15/04/24","stan":"1221601","timestamp":1713160800000,"weight":49.6,"rozdil":0,"temperature":9.6}, {"datum":"15/04/24","stan":"1221601","timestamp":1713171600000,"weight":49.5,"rozdil":-0.1,"temperature":10.4}, {"datum":"15/04/24","stan":"1221601","timestamp":1713182400000,"weight":49.2,"rozdil":-0.3,"temperature":12}, {"datum":"15/04/24","stan":"1221601","timestamp":1713193200000,"weight":49,"rozdil":-0.2,"temperature":16.7}, {"datum":"15/04/24","stan":"1221601","timestamp":1713204000000,"weight":49.2,"rozdil":0.2,"temperature":14.7}]

test_data_weather = [{"datetime":"2024-04-05","datetimeEpoch":1712268000,"tempmax":19.1,"tempmin":6.1,"temp":12.6,"feelslikemax":19.1,"feelslikemin":2.8,"feelslike":12,"dew":8.7,"humidity":78.8,"precip":0.1,"precipprob":32.3,"precipcover":4.17,"preciptype":["rain"],"snow":0,"snowdepth":0,"windgust":40.7,"windspeed":18.1,"winddir":226.9,"pressure":1016.2,"cloudcover":72.7,"visibility":12.3,"solarradiation":21,"solarenergy":2.1,"uvindex":1,"severerisk":10,"sunrise":"06:33:48","sunriseEpoch":1712291628,"sunset":"19:45:16","sunsetEpoch":1712339116,"moonphase":0.88,"conditions":"Partially cloudy","description":"Partly cloudy throughout the day.","icon":"partly-cloudy-day","stations":["05046","03166","LKLN","LKPR","07343","LKKV","AU180","01358","00840"],"source":"comb"}, {"datetime":"2024-04-06","datetimeEpoch":1712354400,"tempmax":22.1,"tempmin":11.9,"temp":17,"feelslikemax":22.1,"feelslikemin":11.9,"feelslike":17,"dew":9.5,"humidity":62.1,"precip":0.1,"precipprob":100,"precipcover":4.17,"preciptype":["rain"],"snow":0,"snowdepth":0,"windgust":31.7,"windspeed":18,"winddir":234.2,"pressure":1017.7,"cloudcover":73,"visibility":16.5,"solarradiation":159.1,"solarenergy":13.8,"uvindex":7,"severerisk":10,"sunrise":"06:31:40","sunriseEpoch":1712377900,"sunset":"19:46:50","sunsetEpoch":1712425610,"moonphase":0.92,"conditions":"Rain, Partially cloudy","description":"Partly cloudy throughout the day with early morning rain.","icon":"rain","stations":["LKLN","LKPR","LKKV","AU180"],"source":"comb"}, {"datetime":"2024-04-07","datetimeEpoch":1712440800,"tempmax":24.2,"tempmin":7.7,"temp":16.5,"feelslikemax":24.2,"feelslikemin":7.7,"feelslike":16.5,"dew":8.3,"humidity":61.2,"precip":0,"precipprob":0,"precipcover":0,"preciptype":None,"snow":0,"snowdepth":0,"windgust":31.7,"windspeed":12.2,"winddir":239.3,"pressure":1017.5,"cloudcover":53.9,"visibility":16.5,"solarradiation":151.7,"solarenergy":13.4,"uvindex":7,"severerisk":10,"sunrise":"06:29:33","sunriseEpoch":1712464173,"sunset":"19:48:24","sunsetEpoch":1712512104,"moonphase":0.95,"conditions":"Partially cloudy","description":"Partly cloudy throughout the day.","icon":"partly-cloudy-day","stations":["LKLN","LKPR","LKKV","AU180"],"source":"comb"}, {"datetime":"2024-04-08","datetimeEpoch":1712527200,"tempmax":25.8,"tempmin":10,"temp":17.6,"feelslikemax":25.8,"feelslikemin":10,"feelslike":17.6,"dew":8.5,"humidity":58.2,"precip":0,"precipprob":0,"precipcover":0,"preciptype":None,"snow":0,"snowdepth":0,"windgust":14.4,"windspeed":8.9,"winddir":102.8,"pressure":1013.1,"cloudcover":45.9,"visibility":10.6,"solarradiation":23.5,"solarenergy":2.4,"uvindex":0,"sunrise":"06:27:26","sunriseEpoch":1712550446,"sunset":"19:49:58","sunsetEpoch":1712598598,"moonphase":0,"conditions":"Partially cloudy","description":"Partly cloudy throughout the day.","icon":"partly-cloudy-day","stations":["05046","03166","LKLN","LKPR","07343","LKKV","AU180","01358","00840"],"source":"obs"}, {"datetime":"2024-04-09","datetimeEpoch":1712613600,"tempmax":25.1,"tempmin":9.4,"temp":15.9,"feelslikemax":25.1,"feelslikemin":7.1,"feelslike":15.9,"dew":9.6,"humidity":68.7,"precip":1,"precipprob":71,"precipcover":12.5,"preciptype":["rain"],"snow":0,"snowdepth":0,"windgust":49.7,"windspeed":20.9,"winddir":279,"pressure":1010.5,"cloudcover":52.6,"visibility":17.6,"solarradiation":197.2,"solarenergy":17.2,"uvindex":7,"severerisk":10,"sunrise":"06:25:20","sunriseEpoch":1712636720,"sunset":"19:51:32","sunsetEpoch":1712685092,"moonphase":0.02,"conditions":"Rain, Partially cloudy","description":"Partly cloudy throughout the day with late afternoon rain.","icon":"rain","stations":["LKLN","LKPR","LKKV","AU180"],"source":"comb"}, {"datetime":"2024-04-10","datetimeEpoch":1712700000,"tempmax":12.2,"tempmin":5.3,"temp":8,"feelslikemax":12.2,"feelslikemin":1.5,"feelslike":6.8,"dew":4.8,"humidity":81.8,"precip":2.231,"precipprob":100,"precipcover":8.33,"preciptype":["rain"],"snow":0,"snowdepth":0,"windgust":40.7,"windspeed":21.2,"winddir":250.6,"pressure":1026.4,"cloudcover":81.4,"visibility":9.7,"solarradiation":21.5,"solarenergy":2.4,"uvindex":0,"sunrise":"06:23:14","sunriseEpoch":1712722994,"sunset":"19:53:06","sunsetEpoch":1712771586,"moonphase":0.05,"conditions":"Rain, Partially cloudy","description":"Partly cloudy throughout the day with early morning rain.","icon":"rain","stations":["05046","03166","LKLN","LKPR","07343","LKKV","AU180","01358","00840"],"source":"obs"}, {"datetime":"2024-04-11","datetimeEpoch":1712786400,"tempmax":15.7,"tempmin":1.6,"temp":8.6,"feelslikemax":15.7,"feelslikemin":0.3,"feelslike":8.5,"dew":4.8,"humidity":79.4,"precip":0,"precipprob":0,"precipcover":0,"preciptype":None,"snow":0,"snowdepth":0,"windgust":19.1,"windspeed":6.8,"winddir":259.8,"pressure":1032.9,"cloudcover":73.7,"visibility":14.2,"solarradiation":142.8,"solarenergy":12.6,"uvindex":8,"severerisk":10,"sunrise":"06:21:09","sunriseEpoch":1712809269,"sunset":"19:54:40","sunsetEpoch":1712858080,"moonphase":0.09,"conditions":"Partially cloudy","description":"Partly cloudy throughout the day.","icon":"partly-cloudy-day","stations":["LKLN","LKPR","LKKV","AU180"],"source":"comb"}, {"datetime":"2024-04-12","datetimeEpoch":1712872800,"tempmax":20.4,"tempmin":3.4,"temp":12,"feelslikemax":20.4,"feelslikemin":3.4,"feelslike":11.9,"dew":4.5,"humidity":64.7,"precip":0,"precipprob":0,"precipcover":0,"preciptype":None,"snow":0,"snowdepth":0,"windgust":30.6,"windspeed":15.4,"winddir":260.1,"pressure":1031.6,"cloudcover":39.4,"visibility":10.4,"solarradiation":22.4,"solarenergy":2.4,"uvindex":0,"sunrise":"06:19:04","sunriseEpoch":1712895544,"sunset":"19:56:14","sunsetEpoch":1712944574,"moonphase":0.12,"conditions":"Partially cloudy","description":"Partly cloudy throughout the day.","icon":"partly-cloudy-day","stations":["05046","03166","LKLN","LKPR","07343","LKKV","AU180","01358","00840"],"source":"obs"}, {"datetime":"2024-04-14","datetimeEpoch":1713045600,"tempmax":21.4,"tempmin":11.4,"temp":16.6,"feelslikemax":21.4,"feelslikemin":11.4,"feelslike":16.6,"dew":8.6,"humidity":60.9,"precip":0,"precipprob":0,"precipcover":0,"preciptype":None,"snow":0,"snowdepth":0,"windgust":52.2,"windspeed":23.3,"winddir":255.2,"pressure":1019.4,"cloudcover":61.4,"visibility":10,"solarradiation":22.5,"solarenergy":2.4,"uvindex":0,"sunrise":"06:14:57","sunriseEpoch":1713068097,"sunset":"19:59:21","sunsetEpoch":1713117561,"moonphase":0.19,"conditions":"Partially cloudy","description":"Partly cloudy throughout the day.","icon":"partly-cloudy-day","stations":["05046","03166","LKLN","LKPR","07343","LKKV","AU180","01358","00840"],"source":"obs"}, {"datetime":"2024-04-15","datetimeEpoch":1713132000,"tempmax":14.4,"tempmin":9.7,"temp":11.5,"feelslikemax":14.4,"feelslikemin":8.6,"feelslike":11.4,"dew":7.1,"humidity":75.1,"precip":1.7,"precipprob":100,"precipcover":25,"preciptype":["rain"],"snow":0,"snowdepth":0,"windgust":61.2,"windspeed":23.4,"winddir":248.1,"pressure":1009,"cloudcover":80.8,"visibility":14.6,"solarradiation":85.4,"solarenergy":7.6,"uvindex":5,"severerisk":10,"sunrise":"06:12:55","sunriseEpoch":1713154375,"sunset":"20:00:55","sunsetEpoch":1713204055,"moonphase":0.25,"conditions":"Rain, Partially cloudy","description":"Partly cloudy throughout the day with a chance of rain throughout the day.","icon":"rain","stations":["LKLN","LKPR","LKKV","AU180"],"source":"comb"}]

# load model
model = BeehiveModel()
print('model loaded', model)
model.load_state_dict(torch.load('model.pt'))
model.eval()


# test_data = test_data.reshape((4, 7))

torch_tensor = torch.tensor(test_data, dtype=torch.float32)

# outputData Float32Array(4) [
#   1.7219171524047852,
#   -0.4825262129306793,
#   -0.06085410714149475,
#   0.5797086358070374
# ]

result = model(torch_tensor)
print(result)